{{#partial "page"}}



<section class="page pages-custom-retail-submission-form">
    {{{region name="page_builder_content"}}}

    <div>
        {{#replace '%%Syndicate%%' page.content}}
        {{> components/page/rss_feed}}
        {{else}}
        <p>{{{page.content}}}</p>
        {{/replace}}
    </div>
    <div class="container">
        <div class="content login">
            {{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
            <div class="select-date">
                <h2 class="header-title">Select Date & Time</h2>
                <div class="date-container">
                    <div> <input class="inline-picker" type="hidden" id="inline-picker"
                            placeholder="Select Date & Time"></div>
                    <div class="time">

                        <button class="date-button">10:00 AM</button>
                        <button class="date-button">10:30 AM</button>
                        <button class="date-button active">11:00 AM</button>
                        <button class="date-button">11:30 AM</button>
                        <button class="date-button">12:00 PM</button>
                        <button class="date-button">12:30 PM</button>
                        <button class="date-button">1:00 PM</button>
                        <button class="date-button">1:30 PM</button>
                        <button class="date-button">2:00 PM</button>
                        <button class="date-button">2:30 PM</button>
                        <button class="date-button">3:00 PM</button>
                        <button class="date-button">3:30 PM</button>
                    </div>
                </div>

            </div>
            <form id="retail-finder-form" class="form">
                <h2 class="header-title">Request an Appointment</h2>
                <div class="form-field filter">
                    <span class="form-label">First Name</span>

                    <input required class="form-input" type="text" name="firstName" placeholder="First Name">

                </div>
                <div class="form-field filter">
                    <span class="form-label">Last Name</span>

                    <input required class="form-input" type="text" name="lastName" placeholder="Last Name">

                </div>
                <!--Add Email-->
                <div class="form-field filter">
                    <span class="form-label">Email</span>

                    <input required class="form-input" type="email" name="email" placeholder="Email">

                </div>
                <div class="form-retail-row">
                    <div class="form-field filter full">
                        <span class="form-label">Phone Number</span>

                        <input id="phone" required class="form-input" type="tel" name="phoneNumber"
                            placeholder="Phone Number">

                    </div>
                    <div class="form-field filter">

                        <span class="form-label">Type</span>
                        <select id="" name="phoneType" class="form-select selector-dropdown">
                            <option value="Home">Home</option>
                            <option value="Mobile">Mobile</option>
                        </select>

                    </div>
                </div>
                <div class="checkbox-fields">
                    <div class="checkbox-field">

                        <label for="register_pass-news"> <input type="checkbox" name="smsAlerts"
                                class="register_pass-news">Receive text
                            alerts</label>
                    </div>
                    <div class="checkbox-field">

                        <label for="register_pass-news"> <input type="checkbox" name="emailAlerts"
                                class="register_pass-news"> Receive
                            Email alerts</label>
                    </div>

                </div>
                <div class="disclaimer">
                    <span>SAMPLE TEXT</span> - Message and data rates may apply. Max 5 msgs/mo. Consent not required to
                    buy
                    goods/svcs. Terms and conditions at ourwebsite.com/terms. Privacy policy at Ourwebsite.com/privacy.
                </div>
                <div class="form-field filter">
                    <span class="form-label">Address 1</span>

                    <input class="form-input" type="text" name="address1" placeholder="Address 1">

                </div>
                <div class="form-field filter">
                    <span class="form-label">Address 2</span>

                    <input class="form-input" type="text" name="address2" placeholder="Address 2">

                </div>
                <div class="city-container">
                    <div class="form-field filter">
                        <span class="form-label">City</span>

                        <input class="form-input" type="text" name="city" placeholder="City">

                    </div>
                    <div class="form-field filter">

                        <span class="form-label">State/Province/Country</span>
                        <select id="" name="state" class="form-select selector-dropdown">
                            <option hidden value="">Select State...</option>
                            <option value="AL">AL</option>
                            <option value="AK">AK</option>
                            <option value="AZ">AZ</option>
                            <option value="AR">AR</option>
                            <option value="CA">CA</option>
                            <option value="CO">CO</option>
                            <option value="CT">CT</option>
                            <option value="DE">DE</option>
                            <option value="FL">FL</option>
                            <option value="GA">GA</option>
                            <option value="HI">HI</option>
                            <option value="ID">ID</option>
                            <option value="IL">IL</option>
                            <option value="IN">IN</option>
                            <option value="IA">IA</option>
                            <option value="KS">KS</option>
                            <option value="KY">KY</option>
                            <option value="LA">LA</option>
                            <option value="ME">ME</option>
                            <option value="MD">MD</option>
                            <option value="MA">MA</option>
                            <option value="MI">MI</option>
                            <option value="MN">MN</option>
                            <option value="MS">MS</option>
                            <option value="MO">MO</option>
                            <option value="MT">MT</option>
                            <option value="NE">NE</option>
                            <option value="NV">NV</option>
                            <option value="NH">NH</option>
                            <option value="NJ">NJ</option>
                            <option value="NM">NM</option>
                            <option value="NY">NY</option>
                            <option value="NC">NC</option>
                            <option value="ND">ND</option>
                            <option value="OH">OH</option>
                            <option value="OK">OK</option>
                            <option value="OR">OR</option>
                            <option value="PA">PA</option>
                            <option value="RI">RI</option>
                            <option value="SC">SC</option>
                            <option value="SD">SD</option>
                            <option value="TN">TN</option>
                            <option value="TX">TX</option>
                            <option value="UT">UT</option>
                            <option value="VT">VT</option>
                            <option value="VA">VA</option>
                            <option value="WA">WA</option>
                            <option value="WV">WV</option>
                            <option value="WI">WI</option>
                            <option value="WY">WY</option>
                        </select>

                    </div>
                    <div class="form-field filter">
                        <span class="form-label">Zip Code</span>

                        <input maxlength="5" class="form-input" type="text" name="zip" placeholder="Zip Code">

                    </div>
                </div>
                <div class="form-retail-row">
                    <div id="eventDate" class="form-field filter flatpickr">
                        <span class="form-label">Event Date</span>

                        <input required name="eventDate" class="form-input date-picker " type="text"
                            placeholder="MM/DD/YYYY">

                    </div>
                    <div class="form-field filter flatpickr">
                        <span class="form-label">Preferred Appointment Dates (choose 3)</span>

                        <input required class="form-input multiple-dates " name="preferredDates" type="text"
                            placeholder="MM/DD/YYYY">
                        <div class="disclaimer">Selected dates are not guaranteed.</div>
                    </div>
                </div>

                <div class="form-field filter">
                    <span class="form-label"># of People Attending</span>

                    <input class="form-input" type="number" name="noOfPeopleAttending"
                        placeholder="# of People Attending">

                </div>
                <div class="checkbox-fields">
                    <div class="checkbox-field">

                        <label for="register_pass-news"> <input name="termsAndCond" type="checkbox"
                                class="register_pass-news">I accept the
                            terms and conditions*</label>
                    </div>


                </div>

                <button class="button" type="submit">Submit</button>

            </form>
            <div id="thank-you">
                <h2 class="header-title">Thank you for requesting an appointment!</h2>
                <p><span>We'll will be in touch with you soon.</span></p>
                <p><button class="button" type="button">Continue Shopping</button></p>
            </div>

        </div>
    </div>

</section>
<script>
    window.addEventListener("load", (event) => {
        // Initialize the date picker on load
        flatpickr('.date-picker', { position: 'below', monthSelectorType: 'static', enableTime: true })
        flatpickr('.inline-picker', { inline: true, monthSelectorType: 'static' })
        flatpickr('.multiple-dates', {
            monthSelectorType: 'static',
            mode: 'multiple', position: 'below', onChange: function (selectedDates, dateStr, instance) {
                var selectedDatesStr = selectedDates.reduce(function (acc, ele) {
                    var str = instance.formatDate(ele, "d/m/Y");
                    acc = (acc == '') ? str : acc + ';' + str;
                    return acc;
                }, '');
                instance.set('enable', [function (date) {
                    if (selectedDates.length >= 3) {
                        var currDateStr = instance.formatDate(date, "d/m/Y")
                        var x = selectedDatesStr.indexOf(currDateStr);
                        return x != -1;
                    } else {
                        return true;
                    }
                }]);
            }
        });
        //Initialize Inputmask 
        Inputmask({ "mask": "(999) 999-9999" }).mask(document.getElementById("phone"));

        const form = document.getElementById('retail-finder-form');
        form.addEventListener('submit', (event) => {
            event.preventDefault(); // prevent the form from being submitted

            // get the form values
            const firstName = form.elements.firstName.value;
            const lastName = form.elements.lastName.value;
            const email = form.elements.email.value;

            const phone = form.elements.phoneNumber.value;
            const phoneType = form.elements.phoneType.value;
            const smsAlerts = form.elements.smsAlerts.checked;
            const emailAlerts = form.elements.emailAlerts.checked;
            const terms = form.elements.termsAndCond.checked;
            const address1 = form.elements.address1.value;
            const address2 = form.elements.address2.value;
            const city = form.elements.city.value;
            const state = form.elements.state.value;
            const zip = form.elements.zip.value;
            const eventDate = form.elements.eventDate.value;
            //strip out time value from event date, date format being YYYY-MM-DD HH:MM
            const eventDateOnly = eventDate.split(' ')[0];
            const eventTime = eventDate.split(' ')[1];
            const noOfPeopleAttending = form.elements.noOfPeopleAttending.value;
            const preferredDates = form.elements.preferredDates.value;
            //get retailer name from querystring
            const retailerName = new URLSearchParams(window.location.search).get('retailerName');
            //get retailer id from querystring
            const retailerId = new URLSearchParams(window.location.search).get('retailerId');



            //get unmasked phone number
            var unmaskedPhone = Inputmask.unmask(phone, { "mask": "(999) 999-9999" });

            // validate the form values
            if (!firstName || !lastName || !email || !phone || !address1 || !city || !state || !zip || !eventDate || !noOfPeopleAttending || !preferredDates) {
                // show an error message if any of the required fields are empty
                alert('Please fill out all the required fields.');
                return;
            }

            if (!terms) {
                // show an error message if the "I Agree" checkbox is not checked
                alert('You must agree to the terms and conditions to continue.');
                return;
            }

            // submit the form using fetch
            const url = 'https://apim.workato.com/allure/allure-b2c-website/retailer/appointmentrequest' // get the form action url
            const method = 'POST' // get the form method (POST, GET, etc.)
            //Generate form data
            const formData = {
                FirstName: firstName,
                LastName: lastName,
                Email: email,
                PhoneNumber: unmaskedPhone,
                Address1: address1,
                Address2: address2,
                City: city,
                State: state,
                PostalCode: zip,
                AppointmentDate: eventDateOnly,
                AppointmentTime: eventTime,
                NumberPeopleinAppointment: parseInt(noOfPeopleAttending),
                EmailOptin: emailAlerts,
                SMSOptin: smsAlerts,
                RetailerName: retailerName,
                RetailerId: retailerId ? parseInt(retailerId) : 0,
                DirectBook: "true",
                PreferredAppointmentDates: preferredDates,
                PhoneType: phoneType
            };

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'API-TOKEN': 'c0bce025e1792e283cfbd229321ecc423ae60257cf462c8d262d7b10fd9e41f9'
                },
                body: JSON.stringify(formData),
            })
                .then((response) => {
                    // do something with the response
                    console.log(response);
                    //hide form section and show thank you section
                    document.getElementById('retail-finder-form').style.display = 'none';
                    document.getElementById('thank-you').style.display = 'block';
                    //Go to top of page
                    window.scrollTo(0, 0);

                })
                .catch((error) => {
                    // handle any errors
                    console.error(error);
                });
        });


    });

</script>
{{/partial}}

{{> layout/base}}